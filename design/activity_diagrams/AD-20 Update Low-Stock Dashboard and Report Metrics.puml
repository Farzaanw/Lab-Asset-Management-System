@startuml
title Update Low-Stock Dashboard and Report Metrics

start

:Receive dashboard request;
:Query inventory data;
:Compute inventory totals;
:Compute low-stock count;
:Return dashboard metrics;

:Receive CSV file;
:Validate CSV rows;

if (Rows valid) then ([valid])
  :Upsert asset records;
  :Recompute inventory totals;
  :Recompute low-stock count;
  :Build import summary;
  :Return summary and updated metrics;
else ([invalid])
  :Build CSV error list;
  :Return validation errors;
endif

while (Inventory change event) is (more)
  :Load affected asset;
  :Recompute quantity and status;

  if (Quantity < threshold) then ([low])
    :Mark asset Low-Stock;
    :Add or update alert entry;
  else ([ok])
    :Clear Low-Stock flag;
    :Remove alert entry if needed;
  endif

  :Recompute low-stock count;
  :Expose updated metrics to dashboard;
endwhile (done)

stop
@enduml
